steps:
  # Step 1: Check out the repository
  - name: 'gcr.io/cloud-builders/git'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        git clone https://github.com/$REPO_OWNER/$REPO_NAME.git /workspace

  # Step 2: Set up Node.js environment (Optional if you need to build before Dockerizing)
  - name: 'node:18'
    id: 'Install Dependencies'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        cd /workspace
        npm install
        npm run build

  # Step 3: Build Docker image
  - name: 'gcr.io/cloud-builders/docker'
    id: 'Build Docker Image'
    args:
      [
        'build',
        '-t',
        'gcr.io/$PROJECT_ID/$IMAGE_NAME:$SHORT_SHA',
        '-f',
        '../docker/job-board.docker',
        '.'
      ]

  # Step 4: Push Docker image to Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    id: 'Push Docker Image'
    args:
      [
        'push',
        'gcr.io/$PROJECT_ID/$IMAGE_NAME:$SHORT_SHA'
      ]

substitutions:
  _IMAGE_NAME: 'job-board'
  _REPO_NAME: 'gcp-job-board-service'
  _REPO_OWNER: 'tnvpandian'
  _BRANCH_NAME: 'develop'

# Trigger settings
trigger:
  branch: '^develop$'
